<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Feedback System - Offline Version</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .animate-slideIn {
            animation: slideIn 0.3s forwards;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useReducer, useState, useEffect, useCallback } = React;

        // --- Configuration ---
        const SECRET_ADMIN_KEY = "admin123";

        const STUDENT_COURSES = [
            { id: 'CS101', name: 'Intro to Programming' },
            { id: 'MA205', name: 'Advanced Calculus' },
            { id: 'HU310', name: 'Critical Writing' },
            { id: 'PH401', name: 'Ethics and AI' },
        ];

        // --- Local Storage Utilities ---
        const storage = {
            // Users storage
            getUsers: () => {
                try {
                    return JSON.parse(localStorage.getItem('feedbackUsers') || '{}');
                } catch {
                    return {};
                }
            },
            
            saveUser: (user) => {
                const users = storage.getUsers();
                users[user.email] = { 
                    ...user, 
                    uid: user.email,
                    createdAt: new Date().toISOString()
                };
                localStorage.setItem('feedbackUsers', JSON.stringify(users));
                return users[user.email];
            },
            
            getUser: (email) => {
                const users = storage.getUsers();
                return users[email];
            },

            // Feedback storage
            getFeedback: () => {
                try {
                    return JSON.parse(localStorage.getItem('feedbackEntries') || '[]');
                } catch {
                    return [];
                }
            },
            
            saveFeedback: (feedback) => {
                const entries = storage.getFeedback();
                const newEntry = {
                    ...feedback,
                    id: Date.now().toString(),
                    timestamp: new Date().toISOString()
                };
                entries.unshift(newEntry);
                localStorage.setItem('feedbackEntries', JSON.stringify(entries));
                return newEntry;
            },
            
            updateFeedback: (id, updates) => {
                const entries = storage.getFeedback();
                const index = entries.findIndex(entry => entry.id === id);
                if (index !== -1) {
                    entries[index] = { ...entries[index], ...updates };
                    localStorage.setItem('feedbackEntries', JSON.stringify(entries));
                    return entries[index];
                }
                return null;
            },

            // Get current user
            getCurrentUser: () => {
                try {
                    return JSON.parse(localStorage.getItem('currentUser') || 'null');
                } catch {
                    return null;
                }
            },

            // Set current user
            setCurrentUser: (user) => {
                localStorage.setItem('currentUser', JSON.stringify(user));
            },

            // Clear current user (logout)
            clearCurrentUser: () => {
                localStorage.removeItem('currentUser');
            }
        };

        // === Reducer and Initial State ===
        const initialState = {
            role: 'student',
            authScreen: 'login',
            studentView: 'home', // Changed default to home
            message: null,
            user: null
        };

        function appReducer(state, action) {
            switch (action.type) {
                case 'SET_ROLE': return { ...state, role: action.payload };
                case 'SET_AUTH_SCREEN': return { ...state, authScreen: action.payload };
                case 'SET_VIEW': return { ...state, studentView: action.payload };
                case 'SHOW_MESSAGE': return { ...state, message: action.payload };
                case 'CLEAR_MESSAGE': return { ...state, message: null };
                case 'SET_USER': return { ...state, user: action.payload };
                default: return state;
            }
        }

        // === Icons ===
        const UserIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const KeyIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 2l-2 2m-7 7l-5 5L4 16m15-5a4 4 0 1 1 0 8 4 4 0 0 1 0-8zm-7 7l-5 5"/><path d="M16.5 16.5L16.5 16.5"/></svg>;
        const DownloadIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const StarIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="1" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
        const ArrowDown = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"/></svg>;
        const HomeIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>;
        const InfoIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>;
        const MessageIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>;
        const ReplyIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 17 4 12 9 7"/><path d="M20 18v-2a4 4 0 0 0-4-4H4"/></svg>;
        const LogOutIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>;
        const BoltIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>;
        const BookIcon = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>;

        // === Components ===

        const StarRating = ({ rating, setRating, disabled = false }) => {
            return (
                <div className="flex items-center space-x-0.5">
                    {[1, 2, 3, 4, 5].map((starValue) => (
                        <button
                            key={starValue}
                            type="button"
                            onClick={() => !disabled && setRating(starValue)}
                            className={`transition ${disabled ? 'cursor-default' : 'hover:scale-110'}`}
                            disabled={disabled}
                        >
                            <StarIcon 
                                className={`w-6 h-6 ${starValue <= rating ? 'text-yellow-500' : 'text-gray-300'}`}
                            />
                        </button>
                    ))}
                </div>
            );
        };

        const MessageBox = ({ message, dispatch }) => {
            useEffect(() => {
                if (message) {
                    const timer = setTimeout(() => {
                        dispatch({ type: 'CLEAR_MESSAGE' });
                    }, 3500);
                    return () => clearTimeout(timer);
                }
            }, [message, dispatch]);

            if (!message) return null;

            const bgColor = message.type === 'success' ? 'bg-green-600' : 'bg-red-600';
            const borderColor = message.type === 'success' ? 'border-green-800' : 'border-red-800';

            return (
                <div className="fixed bottom-4 right-4 z-50">
                    <div className={`p-4 rounded-lg shadow-xl text-white font-semibold flex items-center ${bgColor} border-2 ${borderColor} transition-transform transform duration-300 ease-out animate-slideIn`}>
                        <p>{message.text}</p>
                        <button 
                            onClick={() => dispatch({ type: 'CLEAR_MESSAGE' })} 
                            className="ml-4 text-white opacity-75 hover:opacity-100 font-bold"
                        >
                            &times;
                        </button>
                    </div>
                </div>
            );
        };

        // --- Authentication Components ---
        const LoginForm = ({ dispatch, isSubmitting, setIsSubmitting }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleLogin = async (e) => {
                e.preventDefault();
                setError('');
                setIsSubmitting(true);
                
                try {
                    const user = storage.getUser(email);
                    console.log('Login attempt:', { email, userFound: !!user });
                    
                    if (user && user.password === password) {
                        console.log('Login successful:', user);
                        storage.setCurrentUser(user);
                        dispatch({ type: 'SET_USER', payload: user });
                        dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'Login successful!', type: 'success' } });
                    } else {
                        const errorMsg = !user ? 'No account found with this email.' : 'Incorrect password.';
                        setError(errorMsg);
                        console.log('Login failed:', errorMsg);
                        dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'Login failed.', type: 'error' } });
                    }
                } catch (err) {
                    setError('Login error. Please try again.');
                    console.error("Login error:", err);
                } finally {
                    setIsSubmitting(false);
                }
            };

            return (
                <form onSubmit={handleLogin} className="space-y-4">
                    <h2 className="text-2xl font-bold text-gray-900 text-center">Student Login</h2>
                    <div>
                        <label className="block text-sm font-medium text-gray-700">Email</label>
                        <input
                            type="email"
                            required
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="student@example.com"
                        />
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700">Password</label>
                        <input
                            type="password"
                            required
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="********"
                        />
                    </div>
                    {error && <p className="text-sm text-red-600 text-center">{error}</p>}
                    <button
                        type="submit"
                        className="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 transition"
                        disabled={isSubmitting}
                    >
                        {isSubmitting ? 'Logging In...' : 'Sign In'}
                    </button>
                    <p className="text-center text-xs text-gray-500">
                        Don't have an account? 
                        <button type="button" onClick={() => dispatch({ type: 'SET_AUTH_SCREEN', payload: 'signup' })} className="text-indigo-600 hover:text-indigo-500 font-medium ml-1">
                            Sign Up
                        </button>
                    </p>
                </form>
            );
        };

        const SignUpForm = ({ dispatch, isSubmitting, setIsSubmitting }) => {
            const [name, setName] = useState('');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleSignUp = async (e) => {
                e.preventDefault();
                setError('');
                setIsSubmitting(true);
                
                try {
                    // Check if user already exists
                    if (storage.getUser(email)) {
                        setError('This email address is already in use.');
                        return;
                    }

                    if (password.length < 6) {
                        setError('Password must be at least 6 characters.');
                        return;
                    }

                    // Create new user
                    const newUser = {
                        name: name.trim(),
                        email: email,
                        password: password,
                        uid: email,
                        role: 'student'
                    };

                    console.log('Creating new user:', newUser);
                    storage.saveUser(newUser);
                    storage.setCurrentUser(newUser);
                    dispatch({ type: 'SET_USER', payload: newUser });
                    
                    dispatch({ type: 'SHOW_MESSAGE', payload: { text: `Welcome, ${name.trim()}! Account created successfully.`, type: 'success' } });
                } catch (err) {
                    setError('Signup failed. Please check your details.');
                    console.error("Signup error:", err);
                    dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'Account creation failed.', type: 'error' } });
                } finally {
                    setIsSubmitting(false);
                }
            };

            return (
                <form onSubmit={handleSignUp} className="space-y-4">
                    <h2 className="text-2xl font-bold text-gray-900 text-center">Student Registration</h2>
                    <div>
                        <label className="block text-sm font-medium text-gray-700">Full Name</label>
                        <input
                            type="text"
                            required
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="e.g., Jane Doe"
                        />
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700">Email</label>
                        <input
                            type="email"
                            required
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="student@university.edu"
                        />
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700">Password (min. 6 characters)</label>
                        <input
                            type="password"
                            required
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="********"
                        />
                    </div>
                    {error && <p className="text-sm text-red-600 text-center">{error}</p>}
                    <button
                        type="submit"
                        className="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:opacity-50 transition"
                        disabled={isSubmitting}
                    >
                        {isSubmitting ? 'Registering...' : 'Sign Up'}
                    </button>
                    <p className="text-center text-xs text-gray-500">
                        Already registered? 
                        <button type="button" onClick={() => dispatch({ type: 'SET_AUTH_SCREEN', payload: 'login' })} className="text-indigo-600 hover:text-indigo-500 font-medium ml-1">
                            Sign In
                        </button>
                    </p>
                </form>
            );
        };

        const AdminLogin = ({ dispatch, isSubmitting, setIsSubmitting }) => {
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');

            const handleLogin = (e) => {
                e.preventDefault();
                setIsSubmitting(true);
                setError('');
                if (password === SECRET_ADMIN_KEY) {
                    const adminUser = { 
                        role: 'admin', 
                        name: 'Administrator', 
                        uid: 'admin',
                        email: 'admin@system.com'
                    };
                    storage.setCurrentUser(adminUser);
                    dispatch({ type: 'SET_USER', payload: adminUser });
                    dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'Admin login successful!', type: 'success' } });
                } else {
                    setError('Invalid access key. Access denied.');
                    dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'Admin login failed.', type: 'error' } });
                    setPassword('');
                }
                setIsSubmitting(false);
            };

            return (
                <form onSubmit={handleLogin} className="space-y-4">
                    <div className="text-center mb-4">
                        <KeyIcon className="w-10 h-10 text-red-600 mx-auto mb-2" />
                        <h2 className="text-2xl font-bold text-gray-900">Admin Access</h2>
                        <p className="text-sm text-gray-600 mt-2">Enter the secret admin key</p>
                    </div>
                    
                    <div>
                        <label htmlFor="key" className="block text-sm font-medium text-gray-700">
                            Secret Access Key
                        </label>
                        <input
                            id="key"
                            name="key"
                            type="password"
                            required
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-red-500 focus:border-red-500 transition"
                            placeholder="Enter admin password..."
                        />
                    </div>
                    {error && <p className="text-sm text-red-600 text-center">{error}</p>}
                    <button
                        type="submit"
                        className="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 disabled:opacity-50 transition"
                        disabled={isSubmitting}
                    >
                        {isSubmitting ? 'Unlocking...' : 'Unlock Admin Panel'}
                    </button>
                    <p className="text-center text-xs text-gray-500">
                        <button type="button" onClick={() => dispatch({ type: 'SET_AUTH_SCREEN', payload: 'login' })} className="text-gray-500 hover:text-indigo-600 font-medium transition">
                            &larr; Back to Student Sign In
                        </button>
                    </p>
                </form>
            );
        };

        const AuthScreens = ({ state, dispatch }) => {
            const [isSubmitting, setIsSubmitting] = useState(false);

            let content;
            switch (state.authScreen) {
                case 'signup':
                    content = <SignUpForm dispatch={dispatch} isSubmitting={isSubmitting} setIsSubmitting={setIsSubmitting} />;
                    break;
                case 'admin':
                    content = <AdminLogin dispatch={dispatch} isSubmitting={isSubmitting} setIsSubmitting={setIsSubmitting} />;
                    break;
                case 'login':
                default:
                    content = <LoginForm dispatch={dispatch} isSubmitting={isSubmitting} setIsSubmitting={setIsSubmitting} />;
                    break;
            }

            return (
                <div className="flex items-center justify-center min-h-screen bg-gray-50 font-sans">
                    <div className="w-full max-w-md px-4">
                        <div className="bg-white p-8 rounded-xl shadow-2xl border-t-4 border-indigo-600">
                            {content}
                            
                            {state.authScreen !== 'admin' && (
                                <div className="mt-6 pt-4 border-t border-gray-200">
                                     <p className="text-center text-xs text-gray-500">
                                        Need to access the administrative dashboard?
                                        <button type="button" onClick={() => dispatch({ type: 'SET_AUTH_SCREEN', payload: 'admin' })} className="text-red-600 hover:text-red-500 font-medium ml-1">
                                            Admin Login
                                        </button>
                                    </p>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- Student Views ---
        const StudentHome = ({ user }) => (
            <div className="p-6">
                <h2 className="text-3xl font-bold text-gray-800 mb-6">Welcome to Student Feedback System</h2>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div className="bg-blue-50 p-6 rounded-lg border border-blue-200">
                        <div className="flex items-center mb-4">
                            <MessageIcon className="w-8 h-8 text-blue-600 mr-3" />
                            <h3 className="text-xl font-semibold text-gray-800">Submit Feedback</h3>
                        </div>
                        <p className="text-gray-700">
                            Share your thoughts about your courses. Your feedback helps improve the learning experience for everyone.
                        </p>
                    </div>

                    <div className="bg-green-50 p-6 rounded-lg border border-green-200">
                        <div className="flex items-center mb-4">
                            <ReplyIcon className="w-8 h-8 text-green-600 mr-3" />
                            <h3 className="text-xl font-semibold text-gray-800">Get Responses</h3>
                        </div>
                        <p className="text-gray-700">
                            Receive personalized responses from administrators who value your input and are committed to making improvements.
                        </p>
                    </div>
                </div>

                <div className="bg-white p-6 rounded-lg shadow-lg border border-gray-200">
                    <h3 className="text-2xl font-bold text-gray-800 mb-4">Quick Start Guide</h3>
                    <div className="space-y-4">
                        <div className="flex items-start">
                            <div className="bg-indigo-100 text-indigo-600 rounded-full p-2 mr-4">
                                <span className="font-bold">1</span>
                            </div>
                            <div>
                                <h4 className="font-semibold text-gray-800">Navigate to Feedback</h4>
                                <p className="text-gray-600">Click on "Feedback" in the sidebar to start submitting your course evaluations.</p>
                            </div>
                        </div>
                        <div className="flex items-start">
                            <div className="bg-indigo-100 text-indigo-600 rounded-full p-2 mr-4">
                                <span className="font-bold">2</span>
                            </div>
                            <div>
                                <h4 className="font-semibold text-gray-800">Select Course & Rate</h4>
                                <p className="text-gray-600">Choose your course, give a star rating (1-5), and add any comments.</p>
                            </div>
                        </div>
                        <div className="flex items-start">
                            <div className="bg-indigo-100 text-indigo-600 rounded-full p-2 mr-4">
                                <span className="font-bold">3</span>
                            </div>
                            <div>
                                <h4 className="font-semibold text-gray-800">Submit & Track</h4>
                                <p className="text-gray-600">Submit your feedback and check back later for administrative responses.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div className="mt-8 bg-purple-50 p-6 rounded-lg border border-purple-200">
                    <p className="text-gray-700 text-center">
                        <span className="font-semibold">Welcome, {user?.name || 'Student'}!</span> We're glad to have you here. 
                        Your voice matters in shaping better educational experiences.
                    </p>
                </div>
            </div>
        );

        const StudentAbout = ({ user }) => (
            <div className="p-6">
                <h2 className="text-3xl font-bold text-gray-800 mb-4">Student Account</h2>
                <div className="bg-green-50 p-6 rounded-lg border border-green-200">
                    <p className="font-medium text-gray-700">Name: {user?.name || 'N/A'}</p>
                    <p className="text-gray-700">Email: {user?.email || 'N/A'}</p>
                    <p className="text-gray-700">Role: {user?.role || 'Student'}</p>
                    <p className="text-gray-500 mt-4">
                        Your data is stored locally in your browser. Clear your browser data to reset everything.
                    </p>
                </div>
            </div>
        );

        // NEW: About the System Component
        const AboutSystem = () => (
            <div className="p-6">
                <h2 className="text-3xl font-bold text-gray-800 mb-6">About the Feedback System</h2>
                
                <div className="space-y-8">
                    {/* Mission Section */}
                    <div className="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <div className="flex items-center mb-4">
                            <BookIcon className="w-8 h-8 text-indigo-600 mr-3" />
                            <h3 className="text-2xl font-bold text-gray-800">Our Mission</h3>
                        </div>
                        <p className="text-gray-700 text-lg leading-relaxed">
                            The Student Feedback System was built to create a direct, transparent, and effective communication channel 
                            between students and educational administrators. We believe that student feedback is essential for 
                            continuous improvement in education quality and institutional development.
                        </p>
                    </div>

                    {/* Purpose Section */}
                    <div className="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 className="text-2xl font-bold text-gray-800 mb-4">What This System Was Built For</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="space-y-4">
                                <div className="flex items-start">
                                    <div className="bg-blue-100 text-blue-600 rounded-full p-2 mr-4 flex-shrink-0">
                                        <BoltIcon className="w-4 h-4" />
                                    </div>
                                    <div>
                                        <h4 className="font-semibold text-gray-800">Empower Student Voice</h4>
                                        <p className="text-gray-600 text-sm">Give students a platform to share their experiences and suggestions confidently.</p>
                                    </div>
                                </div>
                                <div className="flex items-start">
                                    <div className="bg-green-100 text-green-600 rounded-full p-2 mr-4 flex-shrink-0">
                                        <MessageIcon className="w-4 h-4" />
                                    </div>
                                    <div>
                                        <h4 className="font-semibold text-gray-800">Improve Course Quality</h4>
                                        <p className="text-gray-600 text-sm">Collect actionable feedback to enhance teaching methods and course content.</p>
                                    </div>
                                </div>
                                <div className="flex items-start">
                                    <div className="bg-purple-100 text-purple-600 rounded-full p-2 mr-4 flex-shrink-0">
                                        <ReplyIcon className="w-4 h-4" />
                                    </div>
                                    <div>
                                        <h4 className="font-semibold text-gray-800">Facilitate Dialogue</h4>
                                        <p className="text-gray-600 text-sm">Enable meaningful conversations between students and administration.</p>
                                    </div>
                                </div>
                            </div>
                            <div className="space-y-4">
                                <div className="flex items-start">
                                    <div className="bg-yellow-100 text-yellow-600 rounded-full p-2 mr-4 flex-shrink-0">
                                        <StarIcon className="w-4 h-4" />
                                    </div>
                                    <div>
                                        <h4 className="font-semibold text-gray-800">Data-Driven Decisions</h4>
                                        <p className="text-gray-600 text-sm">Provide administrators with valuable insights for institutional planning.</p>
                                    </div>
                                </div>
                                <div className="flex items-start">
                                    <div className="bg-red-100 text-red-600 rounded-full p-2 mr-4 flex-shrink-0">
                                        <InfoIcon className="w-4 h-4" />
                                    </div>
                                    <div>
                                        <h4 className="font-semibold text-gray-800">Transparent Process</h4>
                                        <p className="text-gray-600 text-sm">Ensure students see that their feedback is received and addressed.</p>
                                    </div>
                                </div>
                                <div className="flex items-start">
                                    <div className="bg-indigo-100 text-indigo-600 rounded-full p-2 mr-4 flex-shrink-0">
                                        <HomeIcon className="w-4 h-4" />
                                    </div>
                                    <div>
                                        <h4 className="font-semibold text-gray-800">Continuous Improvement</h4>
                                        <p className="text-gray-600 text-sm">Create a culture of ongoing enhancement in educational experiences.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Features Section */}
                    <div className="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 className="text-2xl font-bold text-gray-800 mb-4">Key Features</h3>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div className="text-center p-4 bg-blue-50 rounded-lg">
                                <StarIcon className="w-8 h-8 text-yellow-500 mx-auto mb-2" />
                                <h4 className="font-semibold text-gray-800">Star Rating System</h4>
                                <p className="text-gray-600 text-sm">Quick 1-5 star ratings for easy feedback</p>
                            </div>
                            <div className="text-center p-4 bg-green-50 rounded-lg">
                                <MessageIcon className="w-8 h-8 text-green-500 mx-auto mb-2" />
                                <h4 className="font-semibold text-gray-800">Detailed Comments</h4>
                                <p className="text-gray-600 text-sm">Space for comprehensive written feedback</p>
                            </div>
                            <div className="text-center p-4 bg-purple-50 rounded-lg">
                                <ReplyIcon className="w-8 h-8 text-purple-500 mx-auto mb-2" />
                                <h4 className="font-semibold text-gray-800">Admin Responses</h4>
                                <p className="text-gray-600 text-sm">Direct replies from administrators</p>
                            </div>
                        </div>
                    </div>

                    {/* How It Works */}
                    <div className="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                        <h3 className="text-2xl font-bold text-gray-800 mb-4">How It Works</h3>
                        <div className="space-y-3">
                            <p className="text-gray-700">
                                <span className="font-semibold">For Students:</span> Submit feedback on your courses, track your submissions, 
                                and receive responses from administrators. Your feedback is anonymous to other students but identifiable 
                                to administrators for follow-up.
                            </p>
                            <p className="text-gray-700">
                                <span className="font-semibold">For Administrators:</span> Review all student feedback, identify common themes, 
                                respond to individual concerns, and use the data to make informed decisions about course improvements and 
                                institutional changes.
                            </p>
                        </div>
                    </div>

                    {/* Privacy Notice */}
                    <div className="bg-yellow-50 p-6 rounded-xl border border-yellow-200">
                        <h3 className="text-xl font-bold text-gray-800 mb-3">Privacy & Data</h3>
                        <p className="text-gray-700">
                            This system stores all data locally in your browser. No information is sent to external servers. 
                            Your feedback is only visible to you and authorized administrators. Clear your browser data to 
                            completely remove all stored information.
                        </p>
                    </div>
                </div>
            </div>
        );

        const FeedbackForm = ({ dispatch, user }) => {
            const [selectedCourse, setSelectedCourse] = useState(STUDENT_COURSES[0].name);
            const [rating, setRating] = useState(0);
            const [comment, setComment] = useState('');
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [feedbackList, setFeedbackList] = useState(storage.getFeedback());

            // Filter feedback list to show only the current student's entries
            const studentFeedback = feedbackList.filter(entry => entry.userId === user?.uid);

            const handleSubmitFeedback = async (e) => {
                e.preventDefault();

                if (rating === 0) {
                    dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'Please select a star rating (1-5) before submitting.', type: 'error' } });
                    return;
                }

                setIsSubmitting(true);

                const newFeedback = {
                    userId: user.uid,
                    userName: user?.name || user.email || 'Anonymous Student', 
                    course: selectedCourse,
                    rating: rating,
                    comment: comment.trim(),
                    adminReply: null,
                };

                try {
                    storage.saveFeedback(newFeedback);
                    setFeedbackList(storage.getFeedback());
                    setRating(0);
                    setComment('');
                    dispatch({ type: 'SHOW_MESSAGE', payload: { text: `Thank you! Your feedback for ${selectedCourse} has been submitted.`, type: 'success' } });
                } catch (error) {
                    console.error("Error submitting feedback:", error);
                    dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'Failed to submit feedback.', type: 'error' } });
                } finally {
                    setIsSubmitting(false);
                }
            };

            return (
                <div className="p-6">
                    <h2 className="text-3xl font-bold text-gray-800 mb-6">Post Feedback</h2>
                    
                    <form onSubmit={handleSubmitFeedback} className="bg-white p-8 rounded-xl shadow-lg space-y-6 border border-gray-100 mb-8">
                        {/* Course Dropdown */}
                        <div>
                            <label htmlFor="course-select" className="block text-lg font-semibold text-gray-700 mb-2">
                                1. Select Course/Unit
                            </label>
                            <div className="relative">
                                <select
                                    id="course-select"
                                    value={selectedCourse}
                                    onChange={(e) => setSelectedCourse(e.target.value)}
                                    className="appearance-none block w-full px-4 py-3 pr-10 border border-gray-300 rounded-lg shadow-sm bg-white text-gray-700 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 transition cursor-pointer"
                                >
                                    {STUDENT_COURSES.map(course => (
                                        <option key={course.id} value={course.name}>
                                            {course.id}: {course.name}
                                        </option>
                                    ))}
                                </select>
                                <ArrowDown className="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400 pointer-events-none" />
                            </div>
                        </div>

                        {/* 5-Star Rating */}
                        <div>
                            <label className="block text-lg font-semibold text-gray-700 mb-2">
                                2. Rate the Course (1-5 Stars)
                            </label>
                            <StarRating rating={rating} setRating={setRating} />
                            <p className="text-sm text-gray-500 mt-2">
                                {rating > 0 ? `Selected Rating: ${rating} Stars` : 'Click a star to rate.'}
                            </p>
                        </div>

                        {/* Comment Box */}
                        <div>
                            <label htmlFor="comment" className="block text-lg font-semibold text-gray-700 mb-2">
                                3. Additional Comments (Optional)
                            </label>
                            <textarea
                                id="comment"
                                rows="4"
                                value={comment}
                                onChange={(e) => setComment(e.target.value)}
                                placeholder="What did you like or dislike? How can we improve?"
                                className="block w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 transition"
                            ></textarea>
                        </div>

                        <button
                            type="submit"
                            className="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg shadow-md text-lg font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out disabled:opacity-50"
                            disabled={isSubmitting || rating === 0}
                        >
                            {isSubmitting ? 'Submitting...' : 'Submit Feedback'}
                        </button>
                    </form>

                    {/* Student's Past Feedback & Admin Replies */}
                    <h3 className="text-2xl font-bold text-gray-800 mb-4">Your Submitted Feedback ({studentFeedback.length})</h3>
                    <div className="space-y-4">
                        {studentFeedback.length === 0 ? (
                            <p className="text-gray-500 italic p-4 bg-white rounded-lg shadow">You haven't submitted any feedback yet.</p>
                        ) : (
                            studentFeedback.map((entry) => (
                                <div key={entry.id} className="bg-white p-5 rounded-xl shadow border-l-4 border-indigo-500">
                                    <div className="flex justify-between items-center mb-2">
                                        <span className="text-lg font-semibold text-gray-800">{entry.course}</span>
                                        <StarRating rating={entry.rating} disabled={true} />
                                    </div>
                                    <p className="text-sm text-gray-600 italic">"{entry.comment}"</p>
                                    <p className="text-xs text-gray-400 mt-2">
                                        {new Date(entry.timestamp).toLocaleDateString()} at {new Date(entry.timestamp).toLocaleTimeString()}
                                    </p>
                                    
                                    {entry.adminReply && (
                                        <div className="mt-4 pt-3 border-t border-gray-200">
                                            <p className="font-bold text-sm text-green-700 flex items-center">
                                                <ReplyIcon className="w-4 h-4 mr-2" />
                                                Admin Response:
                                            </p>
                                            <p className="text-sm p-2 bg-green-50 rounded-md text-green-800 whitespace-pre-wrap">
                                                {entry.adminReply}
                                            </p>
                                        </div>
                                    )}
                                    {!entry.adminReply && (
                                        <p className="mt-2 text-xs text-red-500">Awaiting administrative review and reply.</p>
                                    )}
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        };

        // --- Student Portal ---
        const StudentPortal = ({ state, dispatch, user }) => {
            const navItems = [
                { name: 'Home', view: 'home', icon: HomeIcon, title: 'Dashboard Home' },
                { name: 'Feedback', view: 'feedback', icon: MessageIcon, title: 'Post Feedback' },
                { name: 'About System', view: 'aboutSystem', icon: BookIcon, title: 'About the System' },
                { name: 'Account', view: 'about', icon: InfoIcon, title: 'Student Account' },
            ];

            const handleLogout = async () => {
                storage.clearCurrentUser();
                dispatch({ type: 'SET_USER', payload: null });
                dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'You have been logged out.', type: 'success' } });
            };
            
            let content;
            switch (state.studentView) {
                case 'home':
                    content = <StudentHome user={user} />;
                    break;
                case 'about':
                    content = <StudentAbout user={user} />;
                    break;
                case 'aboutSystem':
                    content = <AboutSystem />;
                    break;
                case 'feedback':
                default:
                    content = <FeedbackForm dispatch={dispatch} user={user} />;
                    break;
            }

            return (
                <div className="flex min-h-screen">
                    {/* Sidebar */}
                    <div className="w-64 bg-gray-900 text-white flex flex-col shrink-0">
                        <div className="p-4 text-xl font-bold border-b border-gray-700 flex items-center bg-gray-800">
                            <UserIcon className="w-6 h-6 mr-2 text-indigo-400" /> Feedback System
                        </div>
                        
                        <div className="p-4 bg-gray-800 text-sm font-semibold">
                            Welcome {user?.name?.split(' ')[0] || 'Student'}
                        </div>

                        <nav className="flex-1 space-y-1 p-3">
                            {navItems.map((item) => (
                                <button
                                    key={item.view}
                                    onClick={() => dispatch({ type: 'SET_VIEW', payload: item.view })}
                                    className={`w-full text-left flex items-center px-4 py-3 rounded-lg transition duration-150 ${
                                        state.studentView === item.view 
                                            ? 'bg-indigo-600 text-white shadow-lg' 
                                            : 'text-gray-300 hover:bg-gray-700 hover:text-white'
                                    }`}
                                >
                                    <item.icon className="mr-3" />
                                    {item.title}
                                </button>
                            ))}
                        </nav>

                        <div className="p-4 border-t border-gray-700">
                            <button
                                onClick={handleLogout}
                                className="w-full flex items-center justify-center px-4 py-2 text-sm font-medium rounded-lg text-red-400 bg-gray-800 hover:bg-gray-700 transition"
                            >
                                <LogOutIcon className="w-4 h-4 mr-2" /> Logout
                            </button>
                        </div>
                    </div>

                    {/* Main Content Area */}
                    <main className="flex-1 bg-gray-100 overflow-y-auto">
                        <div className="max-w-6xl mx-auto py-8">
                            {content}
                        </div>
                    </main>
                </div>
            );
        };

        // --- Admin Components ---
        const AdminReplyModal = ({ entry, onClose, dispatch }) => {
            const [replyText, setReplyText] = useState(entry.adminReply || '');
            const [isSubmitting, setIsSubmitting] = useState(false);

            const handleSubmitReply = async (e) => {
                e.preventDefault();
                if (replyText.trim().length === 0) return;

                setIsSubmitting(true);
                try {
                    storage.updateFeedback(entry.id, {
                        adminReply: replyText.trim(),
                    });
                    dispatch({ type: 'SHOW_MESSAGE', payload: { text: `Reply saved for ${entry.userName}.`, type: 'success' } });
                    onClose();
                } catch (error) {
                    console.error("Error updating reply:", error);
                    dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'Failed to save reply.', type: 'error' } });
                } finally {
                    setIsSubmitting(false);
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-2xl w-full max-w-lg">
                        <div className="p-6 border-b">
                            <h3 className="text-xl font-bold text-gray-800">Reply to Feedback from {entry.userName}</h3>
                            <p className="text-sm text-gray-500 mt-1">Course: {entry.course} | Rating: {entry.rating}/5</p>
                        </div>
                        <div className="p-6">
                            <p className="font-medium mb-2 text-gray-700">Original Comment:</p>
                            <div className="p-3 bg-gray-50 rounded-lg text-sm italic mb-4 border border-gray-200 max-h-24 overflow-y-auto">
                                {entry.comment || "No comment provided."}
                            </div>
                            
                            <form onSubmit={handleSubmitReply} className="space-y-4">
                                <label htmlFor="admin-reply" className="block text-sm font-medium text-gray-700">
                                    Admin Response
                                </label>
                                <textarea
                                    id="admin-reply"
                                    rows="4"
                                    value={replyText}
                                    onChange={(e) => setReplyText(e.target.value)}
                                    placeholder="Enter your official response here..."
                                    className="block w-full p-3 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition"
                                    required
                                ></textarea>
                                <div className="flex justify-end space-x-3 pt-2">
                                    <button
                                        type="button"
                                        onClick={onClose}
                                        className="px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition"
                                        disabled={isSubmitting}
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        type="submit"
                                        className="px-4 py-2 text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 transition disabled:opacity-50"
                                        disabled={isSubmitting || replyText.trim().length === 0}
                                    >
                                        {isSubmitting ? 'Saving...' : 'Save Reply'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };

        const AdminPanel = ({ dispatch }) => {
            const [selectedEntry, setSelectedEntry] = useState(null);
            const [feedbackList, setFeedbackList] = useState(storage.getFeedback());
            
            const handleLogout = () => {
                storage.clearCurrentUser();
                dispatch({ type: 'SET_USER', payload: null });
            };
            
            const formatTimestamp = (timestamp) => {
                if (!timestamp) return 'N/A';
                const date = new Date(timestamp);
                return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            };

            const handleExport = () => {
                const data = feedbackList;
                if (data.length === 0) {
                    dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'No feedback data to export.', type: 'error' } });
                    return;
                }

                const headers = ['ID', 'User ID', 'User Name', 'Course Unit', 'Rating (1-5)', 'Comment', 'Admin Reply', 'Timestamp'];
                const csvRows = [headers.join(',')];

                data.forEach(item => {
                    const row = [
                        item.id,
                        item.userId || 'N/A',
                        `"${(item.userName || 'N/A').replace(/"/g, '""')}"`,
                        item.course,
                        item.rating,
                        `"${(item.comment || '').replace(/"/g, '""').replace(/\n/g, ' ')}"`,
                        `"${(item.adminReply || '').replace(/"/g, '""').replace(/\n/g, ' ')}"`,
                        new Date(item.timestamp).toISOString()
                    ];
                    csvRows.push(row.join(','));
                });

                const csvString = csvRows.join('\n');
                const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                
                link.setAttribute('href', url);
                link.setAttribute('download', `feedback_log_${new Date().toISOString().slice(0, 10)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                dispatch({ type: 'SHOW_MESSAGE', payload: { text: 'Feedback log successfully downloaded as CSV.', type: 'success' } });
            };

            return (
                <div className="p-6 md:p-10 max-w-7xl mx-auto min-h-screen">
                    {selectedEntry && (
                        <AdminReplyModal 
                            entry={selectedEntry} 
                            onClose={() => setSelectedEntry(null)} 
                            dispatch={dispatch} 
                        />
                    )}
                    
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 bg-white p-6 rounded-xl shadow-lg border-t-4 border-red-600">
                        <div>
                            <h1 className="text-3xl font-extrabold text-gray-900">
                                Administrator Feedback Panel
                            </h1>
                            <p className="text-gray-600 mt-2">Manage all student feedback and responses</p>
                        </div>
                        <div className="flex space-x-3 mt-4 sm:mt-0">
                            <button
                                onClick={handleExport}
                                className="flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-150 text-sm font-medium shadow-md"
                            >
                                <DownloadIcon className="w-4 h-4 mr-2" /> Export CSV
                            </button>
                            <button
                                onClick={handleLogout}
                                className="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors duration-150 text-sm font-medium shadow-md"
                            >
                                Logout
                            </button>
                        </div>
                    </div>

                    {/* Stats */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        <div className="bg-white p-6 rounded-lg shadow border-l-4 border-blue-500">
                            <h3 className="text-lg font-semibold text-gray-700">Total Feedback</h3>
                            <p className="text-3xl font-bold text-gray-900">{feedbackList.length}</p>
                        </div>
                        <div className="bg-white p-6 rounded-lg shadow border-l-4 border-green-500">
                            <h3 className="text-lg font-semibold text-gray-700">Replied</h3>
                            <p className="text-3xl font-bold text-gray-900">
                                {feedbackList.filter(f => f.adminReply).length}
                            </p>
                        </div>
                        <div className="bg-white p-6 rounded-lg shadow border-l-4 border-red-500">
                            <h3 className="text-lg font-semibold text-gray-700">Pending Reply</h3>
                            <p className="text-3xl font-bold text-gray-900">
                                {feedbackList.filter(f => !f.adminReply).length}
                            </p>
                        </div>
                    </div>

                    {/* Feedback List Table */}
                    <div className="bg-white p-6 rounded-xl shadow-lg">
                        <h2 className="text-xl font-semibold text-gray-700 mb-4">All Feedback Entries ({feedbackList.length})</h2>
                        
                        {feedbackList.length === 0 ? (
                            <div className="text-center py-8">
                                <p className="text-gray-500 italic">No feedback submitted yet.</p>
                                <p className="text-gray-400 text-sm mt-2">Students need to submit feedback first</p>
                            </div>
                        ) : (
                            <div className="overflow-x-auto">
                                <table className="min-w-full divide-y divide-gray-200">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Student</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Course</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rating</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Comment</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {feedbackList.map(entry => (
                                            <tr key={entry.id} className="hover:bg-gray-50">
                                                <td className="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                    {entry.userName}
                                                </td>
                                                <td className="px-4 py-4 whitespace-nowrap text-sm text-gray-700 font-semibold">
                                                    {entry.course}
                                                </td>
                                                <td className="px-4 py-4 whitespace-nowrap">
                                                    <div className="flex items-center">
                                                        <StarRating rating={entry.rating} disabled={true} />
                                                        <span className="ml-2 text-sm text-gray-600">({entry.rating}/5)</span>
                                                    </div>
                                                </td>
                                                <td className="px-4 py-4 text-sm text-gray-600 max-w-xs">
                                                    <div className="truncate" title={entry.comment}>
                                                        {entry.comment || "No comment"}
                                                    </div>
                                                </td>
                                                <td className="px-4 py-4 whitespace-nowrap">
                                                    {entry.adminReply ? (
                                                        <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                                            Replied
                                                        </span>
                                                    ) : (
                                                        <span className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                                            Pending
                                                        </span>
                                                    )}
                                                </td>
                                                <td className="px-4 py-4 whitespace-nowrap text-xs text-gray-400">
                                                    {formatTimestamp(entry.timestamp)}
                                                </td>
                                                <td className="px-4 py-4 whitespace-nowrap">
                                                    <button
                                                        onClick={() => setSelectedEntry(entry)}
                                                        className="flex items-center text-sm px-3 py-1 bg-indigo-500 text-white rounded-md hover:bg-indigo-600 transition"
                                                    >
                                                        <ReplyIcon className="w-4 h-4 mr-1" />
                                                        {entry.adminReply ? 'Edit Reply' : 'Reply'}
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // === Main Application Component ===
        const App = () => {
            const [state, dispatch] = useReducer(appReducer, initialState);

            // Check for existing user on component mount
            useEffect(() => {
                const currentUser = storage.getCurrentUser();
                if (currentUser) {
                    dispatch({ type: 'SET_USER', payload: currentUser });
                }
            }, []);

            // Determine which view to render
            let content;

            if (state.user?.role === 'admin') {
                content = <AdminPanel dispatch={dispatch} />;
            } else if (!state.user) {
                content = <AuthScreens state={state} dispatch={dispatch} />;
            } else {
                content = <StudentPortal state={state} dispatch={dispatch} user={state.user} />;
            }

            return (
                <div className="min-h-screen font-sans">
                    {content}
                    <MessageBox message={state.message} dispatch={dispatch} />
                </div>
            );
        };

        // Render the App
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>